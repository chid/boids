function kdTree(q,o,h){function k(b,c,a){this.obj=b;this.right=this.left=null;this.parent=a;this.dimension=c}function m(b,c,a){var d=c%h.length;if(0==b.length)return null;if(1==b.length)return new k(b[0],d,a);b.sort(function(a,b){return a[h[d]]-b[h[d]]});var e=Math.floor(b.length/2),a=new k(b[e],d,a);a.left=m(b.slice(0,e),c+1,a);a.right=m(b.slice(e+1),c+1,a);return a}function p(b){this.content=[];this.scoreFunction=b}var g=this;this.root=m(q,0,null);this.insert=function(b){function c(a,e){if(null==
a)return e;var d=h[a.dimension];return b[d]<a.obj[d]?c(a.left,a):c(a.right,a)}var a=c(g.root,null);if(null==a)g.root=new k(b,0,null);else{var d=new k(b,(a.dimension+1)%h.length,a),e=h[a.dimension];b[e]<a.obj[e]?a.left=d:a.right=d}};this.remove=function(b){function c(a){if(null==a)return null;if(a.obj===b)return a;var l=h[a.dimension];return b[l]<a.obj[l]?c(a.left,a):c(a.right,a)}function a(b){function c(a,b){if(null==a)return null;var d=h[b];if(a.dimension==b)return null!=a.right?c(a.right,b):a;var e=
a.obj[d],n=c(a.left,b),f=c(a.right,b),i=a;null!=n&&n.obj[d]>e&&(i=n);null!=f&&f.obj[d]>i.obj[d]&&(i=f);return i}function d(a,b){if(null==a)return null;var c=h[b];if(a.dimension==b)return null!=a.left?d(a.left,b):a;var l=a.obj[c],e=d(a.left,b),f=d(a.right,b),i=a;null!=e&&e.obj[c]<l&&(i=e);null!=f&&f.obj[c]<i.obj[c]&&(i=f);return i}if(null==b.left&&null==b.right)if(null==b.parent)g.root=null;else{var f=h[b.parent.dimension];b.obj[f]<b.parent.obj[f]?b.parent.left=null:b.parent.right=null}else{var f=
null!=b.left?c(b.left,b.dimension):d(b.right,b.dimension),r=f.obj;a(f);b.obj=r}}var d=c(g.root);null!=d&&a(d)};this.nearest=function(b,c,a){function d(a){var e;e=h[a.dimension];for(var f=o(b,a.obj),g={},j=0;j<h.length;j++)g[h[j]]=j==a.dimension?b[h[j]]:a.obj[h[j]];g=o(g,a.obj);if(null==a.right&&null==a.left){if(bestNodes.size()<c||f<bestNodes.peek()[1])bestNodes.push([a,f]),bestNodes.size()>c&&bestNodes.pop()}else{e=null==a.right?a.left:null==a.left?a.right:b[e]<a.obj[e]?a.left:a.right;d(e);if(bestNodes.size()<
c||f<bestNodes.peek()[1])bestNodes.push([a,f]),bestNodes.size()>c&&bestNodes.pop();if(bestNodes.size()<c||Math.abs(g)<bestNodes.peek()[1])a=e==a.left?a.right:a.left,null!=a&&d(a)}}bestNodes=new p(function(a){return-a[1]});if(a)for(var e=0;e<c;e++)bestNodes.push([null,a]);d(g.root);a=[];for(e=0;e<c;e++)bestNodes.content[e][0]&&a.push([bestNodes.content[e][0].obj,bestNodes.content[e][1]]);return a};this.balanceFactor=function(){function b(a){return null==a?0:Math.max(b(a.left),b(a.right))+1}function c(a){return null==
a?0:c(a.left)+c(a.right)+1}return b(g.root)/(Math.log(c(g.root))/Math.log(2))};p.prototype={push:function(b){this.content.push(b);this.bubbleUp(this.content.length-1)},pop:function(){var b=this.content[0],c=this.content.pop();0<this.content.length&&(this.content[0]=c,this.sinkDown(0));return b},peek:function(){return this.content[0]},remove:function(b){for(var c=this.content.length,a=0;a<c;a++)if(this.content[a]==b){var d=this.content.pop();a!=c-1&&(this.content[a]=d,this.scoreFunction(d)<this.scoreFunction(b)?
this.bubbleUp(a):this.sinkDown(a));return}throw Error("Node not found.");},size:function(){return this.content.length},bubbleUp:function(b){for(var c=this.content[b];0<b;){var a=Math.floor((b+1)/2)-1,d=this.content[a];if(this.scoreFunction(c)<this.scoreFunction(d))this.content[a]=c,this.content[b]=d,b=a;else break}},sinkDown:function(b){for(var c=this.content.length,a=this.content[b],d=this.scoreFunction(a);;){var e=2*(b+1),h=e-1,g=null;if(h<c){var f=this.scoreFunction(this.content[h]);f<d&&(g=h)}if(e<
c&&this.scoreFunction(this.content[e])<(null==g?d:f))g=e;if(null!=g)this.content[b]=this.content[g],this.content[g]=a,b=g;else break}}}};
